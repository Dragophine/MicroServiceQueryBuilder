<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">App/login/login.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  </ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">App/login/login.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;

angular.module(&apos;queryBuilder.login&apos;, [])
  .controller(&apos;LoginCtrl&apos;, function ($rootScope, $scope, $location, $cookies, loginservice) {

    var self = this;

    /**
     * Stores typed-in username.
     * @type {string}
     */
    $scope.username;
    /**
     * Stores typed-in password.
     * @type {string}
     */
    $scope.password;
    /**
     * Holds if a user is already logged in.
     * @type {string}
     */
    self.loggedin = $rootScope.authenticated;

    /**
	  * Executes the login of the user with the typed in username and password
	  */
    $rootScope.execlogin = function () {

      loginservice.login(self.username, self.password).then(function () {
        updateAuthStatus();
      }, function () {
        $(&quot;#loginErrorModal&quot;).modal();
      });
    };
    
    /**
	  * Executes the logout of the actually logged in user
	  */
    $rootScope.execlogout = function () {

      loginservice.logout();
      $rootScope.admin = false;
      $rootScope.expertMode = false;
      $rootScope.category = false;
      $rootScope.alert = false;
      $rootScope.alertStatistic = false;
      updateAuthStatus();
      $location.path(&quot;/&quot;);
      $rootScope.$broadcast(&apos;login&apos;);
    };

    /**
	  * Updates the Authorization and Authentication status of the application, depending on the logged in user
	  */
    var updateAuthStatus = function () {
      var authenticated = false;
      if (loginservice.principal &amp;&amp; loginservice.authorities) {
        var i = 0;
        while (!false &amp;&amp; i &lt; loginservice.authorities.length) {
          
          if (loginservice.authorities[i].authority == &quot;ROLE_USER&quot;) {
            authenticated = true;
          }
           if (loginservice.authorities[i].authority == &quot;ROLE_ADMIN&quot;) {
             $rootScope.admin = true;
            authenticated = true;
          }
           if (loginservice.authorities[i].authority == &quot;EXPERTMODE&quot;) {
             $rootScope.expertMode = true;
          }
          if (loginservice.authorities[i].authority == &quot;CATEGORY&quot;) {
             $rootScope.category = true;
          }
          if (loginservice.authorities[i].authority == &quot;ALERT&quot;) {
             $rootScope.alert = true;
          }
          if (loginservice.authorities[i].authority == &quot;ALERTSTATISTIC&quot;) {
             $rootScope.alertStatistic = true;
          }
          i++;
        }
      }
      $rootScope.authenticated = authenticated;
      $rootScope.principal = loginservice.principal;

      /**
	    * Broadcasts the authentication change for other functions controllers
	    */
      $rootScope.$broadcast(&apos;authenticationChanged&apos;);
      if ($rootScope.authenticated) {
        $rootScope.$broadcast(&apos;login&apos;);
        $location.path(&quot;/querybuilder&quot;);
      } else {
        $location.path(&quot;/login&quot;);
      }
    };


  });

</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
