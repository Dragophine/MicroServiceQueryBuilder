<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">category/category.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  </ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">category/category.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;

angular.module(&apos;queryBuilder.category&apos;, [&apos;ngRoute&apos;, &apos;queryBuilder.services&apos;])

.config([&apos;$routeProvider&apos;, function($routeProvider) {
  $routeProvider.when(&apos;/category&apos;, {
    templateUrl: &apos;category/category.html&apos;
  });
}])
.controller(&apos;categoryCtrl&apos;, [&apos;$requests&apos;,
	function($requests) {
	var self = this;
	

	/**
     * Holds name from category.
     * @type {string}
     */
	self.name = &quot;&quot;;
	/**
     * Holds description from category.
     * @type {string}
     */
	self.description = &quot;&quot;;	
	/**
     * Holds id from category.
     * @type {string}
     */
  	self.id = &quot;&quot;;
	  /**
     * Store all categories which exists.
     * @type {array}
     */
 	 self.existingCategories = [];
	
	/**
	 * Modal dialog for missing or invalid data.
     * @type {object}
	 */
	var missingDataModal = document.getElementById(&apos;myModalMissingData&apos;);
	/**
	 * Ok-button from modal dialog for missing or invalid data.
     * @type {object}
	 */
	var missingDataOkButton = document.getElementById(&quot;missingDataOk&quot;);
	
	/**
	 * Close modal dialog if user select the ok-button in dialog.
	 */
	missingDataOkButton.onclick = function() {
		missingDataModal.style.display = &quot;none&quot;;
	}
	
	/**
     * Holds the error string which is displayed to the user.
     * The table is only shown when the hasError property is set to TRUE.
     * @type {string}
     */
	self.error = &quot;&quot;;
	 /**
     * If there was an error during the execution of the query this is set to 
     * true and the error will be displayed. Otherwise the table will be displayed.
     * @type {boolean}
     */
	self.hasError = false;
	
	/**
	 * Callback from delete/save category call. If query was successful refresh category names.
	 * Otherwise print error.
	 *
	 * @param {boolean} $success - true when there are no errors.
	 * @param {Object} $data - the requested data.
     * @param {number} $status - the actual server status.
	 */
	self.callback = function($success, $data, $status) {
		self.hasError = !$success;
		if($success){
			// self.existingCategories = $data;
			$requests.getAllCategories(self.getCategories);
		}
		else
		{
			self.error = $data;
		}
	}
	
	 /**
	 * Callback from get all categories call. If query was successful save data in variable self.existingCategories.
	 * Otherwise print error.
	 * 
	 * @param {boolean} $success - true when there are no errors.
	 * @param {Object} $data - the requested data (In this case the categories).
     * @param {number} $status - the actual server status.
	 */
	self.getCategories = function($success, $data, $status) {
		self.hasError = !$success;
		if($success){
			self.existingCategories = $data;
		}
		else
		{
			self.error = $data;
		}
	}	
	$requests.getAllCategories(self.getCategories);
	
	/**
	 * Create new category, if all fields are filled correctly.
	 */
    self.addCategory = function (ev) {
    	checkAllFieldsValidate(true);
        if(self.text != &quot;&quot;){
            missingDataModal.style.display = &quot;block&quot;;
        }
        else
		{
            $requests.addCategory(self.name, self.description, self.callback);
        }
    };
    
	/**
	 * Updates already existing category, if all fields are filled correctly.
	 */
    self.updateCategory = function (ev) {
    	checkAllFieldsValidate(false);
        if(self.text != &quot;&quot;){
            missingDataModal.style.display = &quot;block&quot;;
        }
        else
		{
			$requests.updateCategory(self.id, self.name, self.description, self.callback);
        }
    };
	

	/**
	 * Check if the name from category form already exists.
	 */
	function existsNameAlready() {
		$requests.getAllCategories(self.getCategories);

		for (var i = 0; i &lt; self.existingCategories.length; i++)
	    {
	        if (self.existingCategories[i].name === self.name)
	        {
	            return true;
	        }
	    }
	    return false;
		
	}
	
	/**
	 * Check if all fields in category form are correctly filled.
	 * 
	 * @param {boolean} $checkIfNameExists - Is it necessary to check the name.
	 */
	function checkAllFieldsValidate($checkIfNameExists) {
    	self.text = [];
		if($checkIfNameExists &amp;&amp; (self.name === null || self.name === &quot;&quot;))
		{
            self.text.push(&quot;Bitte geben Sie einen Namen ein.&quot;);
        }
		else if($checkIfNameExists &amp;&amp; existsNameAlready())
		{
			self.text.push(&quot;Der angegebene Name existiert bereits, geben Sie bitte einen anderen Namen an.&quot;);
		}
        
	}
	

	/**
	 * Load selected category.
	 * 
	 * @param {Object} $query - Load this query.
	 */
	self.selectLoad = function($query) {		
		self.name = $query.name;
		self.description = $query.description;
    	self.id = $query.id;		
		self.selectedAlertName = self.name;
	}
	
		/**
	 * Delete selected category.
	 * 
	 * @param {Object} $query - Delete this query.
	 */
	self.selectDelete = function($query) {		
		$requests.deleteCategory($query.id, self.callback);
	}
	
}]);</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
